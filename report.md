# 社会计算第二次实验报告
- 胡煜霄 SA20011027 
- 黄奕桐 SA20011029 
- 马煜昕 SA20011048 
- 华力 SL20215006 
- 尚飞 SA20011054 
- 王雪红 SA20229066 
## 第一部分

## 第二部分
### 实验内容
本部分实验为实现社交约束下的预测，使用不同的方式构造社会网络，使用网络对成员面对一个活动的邀请时的决定进行预测。
该部分要求对以下内容进行分析：
- 不同网络构造方式对结果的影响
- 网络结构演化对结果的影响
- 网络是否加权对结果的影响
- 社交约束与社交级联设计下的效果对比

可选内容：
- 不同社交约束设计方式对效果的影响
- 网络稀疏性问题的有效处理
- 参数敏感性讨论

### 实验分工
本部分需要对社交约束进行分析，因此本部分的实验分为两部分：
1. 使用社交约束和社交级联进行预测(胡煜霄、黄奕桐、华力)
2. 使用神经网络进行预测(马煜昕)

### 实验过程

#### 构造网络
我们首先尝试了直接建立完整的用户相关矩阵，但是数据集中用户有7万多，完整的矩阵需要占用的内存难以用PC机进行运行测试。
随后我们观察了数据集的特征，发现实际上每个事件中做出回应的人的数量很少，因此我们决定在对某件事件进行预测时将此事件所邀请的用户作为已知，仅对这些用户构建网络，以此来控制关系矩阵的稀疏性。
在实验的过程中，我们分别使用用户的Topic相似度，参加的Event相似度，以及对不同事件做出的选择进行了网络的构建。

#### 数据划分
实验要求中要求我们对数据进行五折划分，但是考虑到还需要计算网络结构演变造成的影响，我们采用两种划分方式：
##### 五折划分
将事件列表打乱，随机五等分，然后分别将每份数据作为测试集，剩余数据作为训练集，进行五轮训练和预测。
##### 网络结构演变
将事件按照事件发生的时间进行排序，每100个事件一批，顺序对每一批事件进行预测，并在预测完之后将预测过的事件的真实情况作为已知的训练集作用于网络结构。
#### 进行实验和算法描述
##### 社交约束
我们首先使用用户的Topic相似度进行网络的构建，并进行五折实验。网络构建以及预测的算法如下:
1. 将训练集中的Event信息加入相关Member数据中
2. 找出与要预测的用户相关性最强(共同Topic最多)的10个邻居
3. 找出这些邻居相关的事件集
4. 有关事件与要预测的事件计算相似度
    4.1. 事件之间的相似度用共同topic数表示：(共有Topic数量 ** 2 / 两者各自的topic数量和) 。这里的共同topic数有两种选择，第一种是根据组织者的topic，第二种是根据邀请人员的所有topic。
5. 事件相似度 * 成员相似度，即为这个事件对某个决定(yes, no, maybe)可能性的权重加成
6. 找出可能性权重最大的一个决定即为预测值

之后我们修改了用户之间的相似度的计算方式，使用用户共同参与的事件计算相似度，进行这个操作时我们构建了完整的用户-事件，使用余弦相似度计算用户之间的相似度，并在服务器上运行，用户与某个事件的相关性或者说评分根据其做出的响应来决定：

| yes  | no   | maybe | organizer | 没评分 |
| ---- | ---- | ----- | --------- | ------ |
| 2    | -1   | 1     | 3         | 0      |

上述为普通的推荐过程，为了引入社交关系进行社交约束。我们采用了两种方法进行约束，第一种是使用训练集里面用户参与的每个事件作为组员，第二种是使用待预测事件邀请的人员作为组员。然后在上面第3点处过滤掉不是组员的邻居进行后续预测。

##### 社交级联

随后我们引入社交级联的内容进行分析，算法如下：

1. 首先仍旧是对回应的用户进行网络构建

2. 计算每个用户之间的相似性
    2.1.  一种方式是对用户做出的选择不同分别构建三个矩阵，表示用户对此事件做出各个选择的影响的强度。 此种方式下构建的图是有向的：(member1, member2)的边权为 (member1和member2都作出这种选择的事件数 / member2做出这种选择且member1做出回应的事件数) 这条边的权值即为member2做出一种决定时member1做出相同决定的概率
    2.2. 另一种方式是对用户参与的事件构建用户-事件关系矩阵，依据做出的回应来决定此事件的得分。用户之间的事件相似度用余弦相似度表示，计算方法和社交约束的用户相似度计算方法类似。
3. 初始化网络，使每个成员做出一个初始的决定，这个决定为此成员对这个组中的事件的回应最多次数的决定。
4. 每个成员接受其他成员的影响，并依据不同选择进行加权，将此成员的选择更改为得分最高的选择。并进行10次迭代
5. 最后每个成员的选择即为预测值
##### 网络结构演变
随后我们对网络的演变进行分析，不再使用五折检测，而是使用第二种划分方式，同时对每个事件的预测均使用级联的方式。
首先我们不对事件随时间变化的权重做任何处理，只是训练数据集随时间的变化增加。
然后我们依据时间对事件加上权重，即越久远的事件的权重越轻。这个权重将被用于计算用户间的相似性。

#### 实验结果及分析
##### 社交约束

<table width="485">
<tbody>
<tr>
<td width="112">用户相似度计算</td>
<td width="166">事件相似度计算</td>
<td width="102">社交约束</td>
<td width="105">5折平均准确度</td>
</tr>
<tr>
<td rowspan="6">用户共同topic</td>
<td rowspan="3">组织者共同topic</td>
<td>同Group用户</td>
<td>62.48%</td>
</tr>
<tr>
<td>Event邀请用户</td>
<td>62.81%</td>
</tr>
<tr>
<td>无</td>
<td>62.35%</td>
</tr>
<tr>
<td rowspan="3">Event邀请用户共同topic</td>
<td>同Group用户</td>
<td>66.05%</td>
</tr>
<tr>
<td>Event邀请用户</td>
<td>66.64%</td>
</tr>
<tr>
<td>无</td>
<td>64.94%</td>
</tr>
<tr>
<td rowspan="6" width="112">用户参与事件的评分矩阵（余弦相似度）</td>
<td rowspan="3">组织者共同topic</td>
<td>同Group用户</td>
<td>66.07%</td>
</tr>
<tr>
<td>Event邀请用户</td>
<td>66.35%</td>
</tr>
<tr>
<td>无</td>
<td>66.21%</td>
</tr>
<tr>
<td rowspan="3">Event邀请用户共同topic</td>
<td>同Group用户</td>
<td>N/A</td>
</tr>
<tr>
<td>Event邀请用户</td>
<td>72.65%</td>
</tr>
<tr>
<td>无</td>
<td>71.21%</td>
</tr>
</tbody>
</table>

注：其中一个数据运行时间过长，没获得

##### 社交级联

| 用户相似度计算                       | 准确度 |
| ------------------------------------ | ------ |
| 用户参与事件的评分矩阵（余弦相似度） | 67.79% |
| 用户对不同事件做出的选择             | 69.60% |

##### 网络结构演变
不对事件进行权重处理时得到结果如下：\
【图表1】\
可以见到，随着时间的演变，一开始准确度整体呈上升趋势，但是到接近第30000个事件后，准确度开始有所下降，推测这可能是由于时间长了之后用户的兴趣和决策可能会产生转变，因此最近的事件应对用户决策有较强的影响，比较久远的事件产生的影响更小一点。
因此我们对事件的权重随时间进行调整，但是效果并不理想\
【图表2】\
随后我们又依据时间戳的值进行不同的函数运算得到事件的权值，如softmax，线性，开根号等，只有开根号能够达到与不加权重差不多的效果，推测可能有其他因素产生用户兴趣转移的现象。